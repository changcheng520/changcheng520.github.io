/*
' 《Extreme Point》
'  Technology: HTML5+CSS3+Ajax
'  Design: 没位道 https://www.c945.com
*/	



$(function(){
	
	

	var $nav = $("#mainNav");
	var $logo = $("#logo");
	var $maskLoad =  $("#maskLoad");

	
	//remove loading
	$maskLoad.fadeOut(1000);

	//模板初始化
	$nav.css({"width":"0px","overflow":"hidden"});
	$("#ie6alert").css({"visibility":"hidden"});
	setTimeout(function(){
		$nav.animate({width: "100%"},{duration: 1000,easing:"easeInOutCirc"});
		$("#mainNav ul.nav li.item").animate({height: "82px"},{duration: 1000,easing:"easeInOutCirc"});
		$logo.fadeIn(1000);
		
	},500)


	//遍历判断导航
	$("#ZGVmYXVsdC5o").css({"width":"0","text-indent":"-9999px"});//隐藏首页链接
	
	$("#mainNav .item").each(function(){
		var dh = $(" a",this).attr("href");
		dh = dh.replace(webHost,"");
		$(" a",this).attr("data-url",dh);
		//子菜单
		$(" .sub-item",this).each(function(){
			var dhs = $(" a",this).attr("href");
			dhs = dhs.replace(webHost,"");
			$(" a",this).attr("data-sub-url",dhs);
			$(" a",this).attr("href","javascript:");
		});

		
		$(" a",this).attr("href","javascript:");
	});
	

	
	$("#mainNav .item a").click( 
		function () {
			var thisURL = $(this).attr("data-url");
			showac_subitem(thisURL,'',0);
	});
	
	$("#mainNav .sub-item a").click( 
		function () {
			var thisURL = $(this).attr("data-sub-url");
			showac_subitem(thisURL,'',0);
	});
	
	
	setTimeout(function(){
		for (var k = 0;k<14;k++){
			 $("#mainNav li:eq(" + k + ")").fadeIn(500*k);
		}
	},1500);
	
	
	//DS.switcher
	$nav.DSNavs({
		useHash:true,
		returnNow:true 
	})


});

/*ajax function*/
$(document).ready(function() {
    $('#mainNav ul.nav li').mousemove(function() {
        var $subMenuBox = $(this).find('ul');
        $('#mainNav ul.nav li ul').css({
            "display": "none"
        });
        $subMenuBox.css({
            "display": "block"
        });
        $subMenuBox.mouseleave(function() {
            $subMenuBox.css({
                "display": "none"
            })
        })
    })
});
function showac_subitem(url, title, listShow) {
    var fhtml = "";
    var showBoxX = parseInt(Math.random() * 1500 + 1) - parseInt(Math.random() * 1500 + 1);
    fhtml = fhtml + '	<section class="ac_subitem"> ';
    fhtml = fhtml + '		<span class="ac_close"></span> ';
    fhtml = fhtml + '		<h2>' + title + '</h2> ';
    fhtml = fhtml + '		<div class="show" id="s-show"> ';
    fhtml = fhtml + '			<!-- 栏目内容区 begin --> ';
    fhtml = fhtml + '			 <span id="loading"></span> ';
    fhtml = fhtml + '			 <section id="containerBox"></section> ';
    fhtml = fhtml + '			<!-- 栏目内容区 end --> ';
    fhtml = fhtml + '		</div> ';
    fhtml = fhtml + '	</section> ';
    $("#floatContainer").html(fhtml);
	//防止replace不存在错误
	if(url.indexOf("#right_content") >= 0){
		url = url.replace("#right_content","");
	}	
    
    var listURL = new Array();
    listURL = url.split("\/");
    var listURLNum = listURL.length;
    var newURL = listURL[listURLNum - 1];
    if (newURL.indexOf(".html") > 0 && newURL.indexOf("_") > 0) {
        $.cookie("DSURLList", url)
    };
    if (listShow != 1) {
        $(document).ready(function() {
            var $itemBox = $(".ac_subitem");
            var $itemBoxShow = $(".ac_subitem .show");
            var $itemBoxClose = $(".ac_close");
            var $nav = $("#mainNav");
            $itemBox.stop().animate({
                left: showBoxX + 'px'
            });
            $nav.slideUp(500);
			
            setTimeout(function() {
                $itemBox.stop().animate({
                    height: (pageHeight - 200) + 'px',
                    left: (pageWidth - showBoxW) / 2 + "px",
                    top: (pageHeight - showBoxW) / 2 + "px"
                },
                400,
                function() {});
                $itemBoxShow.css({
                    width: (showBoxW) - 70 + "px",
                    height: (pageHeight - 150) - 150 + "px"
                });
                $itemBoxShow.animate({
                    marginLeft: "30px"
                },
                {
                    duration: 500,
                    easing: "easeInOutCirc"
                })
            },
            500);
            $itemBoxClose.click(function() {
                $itemBox.stop().animate({
                    height: 0
                });
                $nav.slideDown(500);
				$("#secFrame_recent").fadeOut(500);	
				
            })
        })
    };
    if (listShow == 1) {
        $(document).ready(function() {
            var $itemBox = $(".ac_subitem");
            var $itemBoxShow = $(".ac_subitem .show");
            var $itemBoxClose = $(".ac_close");
            var $nav = $("#mainNav");
            $itemBox.css({
                "height": (pageHeight - 200) + "px",
                "left": (pageWidth - showBoxW) / 2 + "px",
                "top": (pageHeight - showBoxW) / 2 + "px"
            });
            $nav.slideUp(500);
            setTimeout(function() {
                $itemBoxShow.css({
                    width: (showBoxW) - 70 + "px",
                    height: (pageHeight - 150) - 150 + "px"
                });
                $itemBoxShow.animate({
                    marginLeft: "30px"
                },
                {
                    duration: 500,
                    easing: "easeInOutCirc"
                })
            },
            100);
            $itemBoxClose.click(function() {
                $itemBox.stop().animate({
                    height: 0
                });
                $nav.slideDown(500);
				$("#secFrame_recent").fadeOut(500);	
            })
        })
    };
    $(".ac_subitem").fadeIn(1000);
    $("html,body").css("overflow", "hidden");
    absolutePositionCheck(".ac_subitem");
    $(".ac_subitem #loading").fadeIn();
	
    $(".ac_subitem #containerBox").hide().load( url,
    function(responseText, textStatus, XMLHttpRequest) {
        if (textStatus == "error") {
            $(".ac_subitem #loading").fadeIn(500).html("地址不存在")
        } else if (textStatus == "timeout") {
            $(".ac_subitem #loading").fadeIn(500).html("加载超时,请刷新")
        } else {
			//加载完成
			$(this).fadeIn(200);
			$(".ac_subitem #loading").fadeOut(500);
			//滚动条(图片加载完成后)
			setTimeout(function(){
				$(".ac_subitem .show").jscroll({W:"3px"});
			},1500);
			$(".ac_subitem .show img").load(function(){ 
				setTimeout(function(){
					/*
					注意：.ac_subitem .show里不要包含 iframe 否则滚动条无法正常加载显示
					*/
					$(".ac_subitem .show").jscroll({W:"3px"});

				},500);
			});


        }
    })
}

