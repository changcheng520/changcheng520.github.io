{"pageProps":{"currentData":{"ID":593333,"author":"1","author_nickname":"wpuser","author_display_name":"Chuckie Chang","author_url":"https://matrixflip.com/api","author_username":"wpuser","author_avatar":"https://secure.gravatar.com/avatar/?s=96&d=mm&r=g","categories":[87],"categories_output":[{"ID":87,"slug":"%e5%bc%80%e5%8f%91%e8%b6%a3%e5%91%b3","name":"开发趣味","term_taxonomy_id":87,"term_group":0,"taxonomy":"category","description":"","parent":0,"count":17}],"tags":[88,89,183,162],"tags_output":[{"ID":88,"slug":"centos","name":"CentOS","term_taxonomy_id":88,"term_group":0,"taxonomy":"post_tag","description":"","parent":0,"count":3},{"ID":89,"slug":"linux","name":"Linux","term_taxonomy_id":89,"term_group":0,"taxonomy":"post_tag","description":"","parent":0,"count":2},{"ID":183,"slug":"mariadb","name":"MariaDB","term_taxonomy_id":183,"term_group":0,"taxonomy":"post_tag","description":"","parent":0,"count":1},{"ID":162,"slug":"%e6%95%b0%e6%8d%ae%e5%ba%93","name":"数据库","term_taxonomy_id":162,"term_group":0,"taxonomy":"post_tag","description":"","parent":0,"count":2}],"thumbnail":["/static-remote/files/c945-com_0f58e3dc508fb9654b08a98e-770x340-4-matrixflipcomapiwpcontentuploadsccomfedcfbbaexjpg.jpg",770,340,false],"thumbnail_mini":["/static-remote/files/c945-com_0f58e3dc508fb9654b08a98e-770x340-4-150x150-matrixflipcomapiwpcontentuploadsccomfedcfbbaexxjpg.jpg",150,150,true],"thumbnail_retina":["/static-remote/files/c945-com_0f58e3dc508fb9654b08a98e-770x340-4-matrixflipcomapiwpcontentuploadsccomfedcfbbaexjpg.jpg",770,340,false],"thumbnail_full":["/static-remote/files/c945-com_0f58e3dc508fb9654b08a98e-770x340-4-matrixflipcomapiwpcontentuploadsccomfedcfbbaexjpg.jpg",770,340,false],"date_day":"12","date_month":"12","date_month_e":"December","date_year":"2016","date_weekday":"Monday","title":"最近由于各种原因，新网站服务器数据库总出问题，终于解决了CentOS 7服务器下的MariaDB数据库崩溃问题","excerpt":"自从做了全职境外自由职业，自己运营服务器在国外的网站时，经常发生数据库连接崩溃问题，至于超载还是连接数等等，已经解决了。最近又出现了因为偶然问题，造成的数据库崩溃。很头疼，之前遇到了，以为解决了最大连...","content":"<p><span>自从做了全职境外自由职业，自己运营服务器在国外的网站时，经常发生数据库连接崩溃问题，至于超载还是连接数等等，已经解决了。最近又出现了因为偶然问题，造成的数据库崩溃。很头疼，之前遇到了，以为解决了最大连接数等问题就可以解决了，但是不然，还是发生了！</span><img alt=\"发呆\" src=\"/static-remote/files/2-matrixflipcomapiwpcontentuploadsgif.gif\" /></p>\n<p>最后还是得感谢Google，没有它，估计也一直解决不了。当然之前也是问了CSDN等社区，也没解决。我的服务器是<strong>CentOS 7</strong>，数据库是<strong>MariaDB</strong>，MYSQL经常出现意外的崩溃，总是要手动重启服务器或者重启数据库来解决，很是头疼。万一自己出门有个时间没看网站怎么办，岂不是要丢生意了。</p>\n<p>无奈之下，疯狂的google, Stack Overflow等等，试了很多方法，终于搞定了，让数据库崩溃的时候快速自动重启就可以恢复。关于<strong>MariaDB</strong>的官方资料，可以参考<a href=\"https://mariadb.com/kb/en/mariadb/starting-and-stopping-mariadb/\" target=\"_blank\" style=\"font-weight: bold;\" rel=\"noopener\">https://mariadb.com/kb/en/mariadb/starting-and-stopping-mariadb/</a></p>\n<p>终于松了一口气啦，<img alt=\"大笑\" src=\"/static-remote/files/13-matrixflipcomapiwpcontentuploadsgif.gif\" />平时又要画界面又要搞开发还要维护服务器等等，真是有点头大啊，不过嘛，由于生活所迫，也不可能啥都求人，靠别人不如靠自己，所以各种折腾，也学会了架设和维护自己的linux服务器。下面说说解决办法吧，遇到有类似问题的童鞋，也可以参考下。</p>\n<p>有些代码是简写了，有一点linux命令基础的可以看懂，步骤大概就是这样的。#是注释，大家都懂的，剩下的就是命令了，命令我用红色标注。</p>\n</p>\n<p>#首先确保此文件存在 /etc/systemd/system/multi-user.target.wants/mariadb.service</p>\n<p><span style=\"color:#ff0000;\">vi /etc/systemd/system/multi-user.target.wants/mariadb.service</span></p>\n</p>\n<p>#在[Service]下面加入以下行</p>\n<p><span style=\"color:#ff0000;\">Restart=always</span></p>\n<p>#保存退出<span style=\"color:#ff0000;\"><br /></span></p>\n<p><span style=\"color:#ff0000;\">:wq</span></p>\n</p>\n<p>#重新加载系统守护程序</p>\n<p><span style=\"color:#ff0000;\">sudo systemctl daemon-reload</span></p>\n<p><span style=\"color:#ff0000;\">sudo systemctl restart mariadb.service</span></p>\n</p>\n<p>#重启服务器,稍等十几秒后恢复</p>\n<p><span style=\"color:#ff0000;\">sudo reboot   </span></p>\n</p>\n<p>#模拟数据库崩溃的效果，查找进程看到类似ID后可以kill掉</p>\n<p><span style=\"color:#ff0000;\">ps -ef | grep mysql </span></p>\n</p>\n<p>#强制终止进程（如果/etc/systemd/system/multi-user.target.wants/mariadb.service文件修改成功，择数据库被kill后，会立刻重启恢复）</p>\n<p> #这里的ID要根据自己的服务器查看</p>\n<p><span style=\"color:#ff0000;\">sudo kill -9 2550</span></p>\n<p><span style=\"color:#ff0000;\">sudo kill -9 1590</span></p>\n<p></p>\n<p> 你可以看到当你kill了进程后，数据库重启了，ID变动了，如下图所示：</p>\n<p><img src=\"/static-remote/files/ed7f86f9e649511c1ec03f78-matrixflipcomapiwpcontentuploadsedffececfjpg.jpg\" alt=\"\" /></p>\n<p></p>\n<p><strong>#有些服务器只要经过上面的步骤就可以解决自动重启恢复的问题了，如果怕存在其它的数据库服务器重启问题，可以继续执行下面的步骤，避免后患：</strong></p>\n<p><strong>这样就可以模拟出可能遇见的问题（也就是我网站发生数据库崩溃，无法连接的一些遇到过的错误信息）：</strong></p>\n<p><img src=\"/static-remote/files/65d58c9d71c8c4350924c3ce-matrixflipcomapiwpcontentuploadsdcdccccejpg.jpg\" alt=\"\" /></p>\n<p></p>\n<p>#让崩溃后的数据库服务器自动重启，需要配置/etc/inittab文件，首先备份一个，编辑此文件一定要非常小心</p>\n<p><span style=\"color: rgb(255, 0, 0);\">sudo cp /etc/inittab /etc/inittab.orig</span></p>\n<p><span style=\"color:#ff0000;\">vi /etc/inittab</span></p>\n</p>\n<p>#结尾处增加一行，在/ etc / inittab文件中放置一个命令，以在mysqld_safe进程崩溃时重新生成mysqld_safe进程。 它有四个字段，每个字段与冒号（:)分隔开</p>\n<p><span style=\"color:#ff0000;\">ms:2345:respawn:/bin/sh /usr/bin/mysqld_safe</span></p>\n<p><span style=\"color:#ff0000;\">:wq</span></p>\n</p>\n<p>#保存后重启服务</p>\n<p><span style=\"color:#ff0000;\">systemctl restart mariadb.service </span></p>\n</p>\n<p>#重启服务器,稍等十几秒后恢复</p>\n<p><span style=\"color:#ff0000;\">sudo reboot   </span></p>\n</p>\n<p>#查看服务状态</p>\n<p><span style=\"color:#ff0000;\">sudo service mariadb status</span></p>\n<p></p>\n<p>OK，结束了，就这么多，自己总算是松了一口气啦，要不然随时都要盯着网站，一直担心由于各种原因造成数据库崩溃无法连接网站的问题，多头疼。哈哈，总算是有收获，又学会了新技能。以至于如何配置服务器，如何做一些最初的优化调整设置，如何安装SSL证书等等，也是经过了自己不少的摸索学习的，全部一一解决啦。奖励自己，吃点东西看场电影，休息啦。新网站也不放出来了，因为业务等等全是境外的，和自己这个中文博客啥的一点关系没有，这个只是记录自己的生活学习工作咯，用中文的方式。好了，如果大家看了我这些原创文章对自己有帮助，也可以经常关注我的博客，我一直在写博客，虽然写的不多，大多都是自己想自己总结学习出来的成果，是一个沉淀。</p>\n","slug":"e18c3a9b378f3bf1b67aebbd","prev":[{"ID":583333,"title":"做设计和开发的八大职业鸡汤，对后辈们想说的话","excerpt":"在这里我想分享一下属于我的一部分人生哲理，或许对你有用，或许对你没用，不过，这些都不重要，重要的，这些都是我自己想的和分享的，是我自己码字的。之前做过Web的讲师，自己对于Web UI，前端开发，后端开发等等有...","slug":"7a2d5cdad3ba491523e72d4a","post_date":"2016-11-03 10:28:53","post_date_gmt":"2016-11-03 10:28:53","thumbnail":["/static-remote/files/c945-com_2cab1f6d3d4a3ce24bc63c3e-770x340-4-matrixflipcomapiwpcontentuploadsccomcabfddacebccexjpg.jpg",770,340,false],"thumbnail_mini":["/static-remote/files/c945-com_2cab1f6d3d4a3ce24bc63c3e-770x340-4-150x150-matrixflipcomapiwpcontentuploadsccomcabfddacebccexxjpg.jpg",150,150,true],"thumbnail_retina":["/static-remote/files/c945-com_2cab1f6d3d4a3ce24bc63c3e-770x340-4-matrixflipcomapiwpcontentuploadsccomcabfddacebccexjpg.jpg",770,340,false]}],"next":[{"ID":603333,"title":"更新了Dreamweaver CC和Photoshop CC到最新的2017版本，体验增强了很多，效率提高","excerpt":"最近把自己常用的Dreamweaver CC 和 Photoshop CC更新到了最新的2017版，特别是DW，在代码的规范性，自动填充，代码辅助，站点管理预览等等方面，做了很大的优化改进，还有编辑器，可以使用深色风格了，这个对眼睛是...","slug":"393a5d9b0ac1797776e6657a","post_date":"2016-12-15 12:03:38","post_date_gmt":"2016-12-15 12:03:38","thumbnail":["/static-remote/files/c945-com_e0c17392816b2c929df0cad9-770x340-4-matrixflipcomapiwpcontentuploadsccomecbcdfcadxjpg.jpg",770,340,false],"thumbnail_mini":["/static-remote/files/c945-com_e0c17392816b2c929df0cad9-770x340-4-150x150-matrixflipcomapiwpcontentuploadsccomecbcdfcadxxjpg.jpg",150,150,true],"thumbnail_retina":["/static-remote/files/c945-com_e0c17392816b2c929df0cad9-770x340-4-matrixflipcomapiwpcontentuploadsccomecbcdfcadxjpg.jpg",770,340,false]}],"post_date":"2016-12-12 00:27:05","post_date_gmt":"2016-12-12 00:27:05","post_status":"publish","comment_status":"open","ping_status":"open","post_password":"","to_ping":"","pinged":"","post_modified":"2016-12-12 00:27:05","post_modified_gmt":"2016-12-12 00:27:05","post_content_filtered":"","post_parent":0,"guid":"https://matrixflip.com/api/?post_type=post&amp;p=593333","menu_order":0,"post_type":"post","post_mime_type":"","comment_count":"0","filter":"raw"},"postID":"e18c3a9b378f3bf1b67aebbd"},"__N_SSG":true}